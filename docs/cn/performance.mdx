# 性能

在大多数情况下，Pattaya 的性能不是主要问题。但在需要时，以下是一些提升性能的建议。

## 消除不必要的更新

大多数 JavaScript 中的赋值操作（例如数字赋值、浅拷贝对象）速度非常快。
如果你的应用中存在过多的更新回调，尝试消除不必要的分支逻辑。

另一方面，在很多情况下，你可以直接更新状态和属性。
与其过度优化，不如采用简单直接的方法，通常也能获得足够快的性能。

## 使用动画，但不要滥用动画

避免过多的动画效果。
虽然现代渲染引擎可以同时处理数千个动画，
但过多的动画可能引入额外开销，从而降低性能。

## 缓存常量对象

在使用渐变色或图案装饰元素时，
避免每次重新创建，应该将其缓存起来，可以存储在全局状态或直接在 element.data 中。

如果某个对象的计算或内存开销较大，也应根据需要进行缓存。

## 处理 10,000+ 节点

Depict 和 Pattaya 并不是为超大规模图形设计的。
它们主要优化用于交互式图表，如 UML、仪表盘、动态图形 UI，
通常可以高效地处理 50 到 500 个节点。

虽然引擎可以支持几千个节点，但具体上限取决于动画数量、形状复杂度、文本渲染和所选的渲染器等因素。
如果需要大规模渲染，建议使用基于 WebGL 或 WebGPU 的方案。

## 避免手动绘制形状

在每次重新渲染时反复调用 ctx.drawXX 是低效的。
应该批量处理操作，并生成操作指令字符串来优化渲染过程。

例如，如果你只需要更改颜色或线宽，
就没必要每次都重新计算扇形角度和弧线。
手动缓存绘图操作（尤其是渐变色和图案）可以显著提升性能。
